<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Neon Runner</title>
  <style>
    /* ===================
       GLOBAL STYLE
    =================== */
    body {
      margin: 0;
      background: #0a0a0f;
      color: #fff;
      font-family: 'Poppins', sans-serif;
      overflow: hidden;
    }

    canvas {
      display: block;
      margin: 0 auto;
      background: radial-gradient(circle at center, #111 0%, #000 100%);
    }

    /* ===================
       OVERLAY (menu/start/game over)
    =================== */
    .overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.85);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }

    .overlay h1 {
      font-size: 3em;
      color: #ff00cc;
      text-shadow: 0 0 10px #ff00cc, 0 0 20px #00ffff;
      margin-bottom: 20px;
    }

    .actions {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .actions button {
      padding: 10px 20px;
      font-size: 1.1em;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: 0.2s;
    }

    .cta {
      background: linear-gradient(45deg,#ff00cc,#3333ff);
      color: #fff;
    }

    .cta:hover {
      opacity: 0.8;
    }

    .ghost {
      background: transparent;
      border: 2px solid #888;
      color: #ccc;
    }

    .ghost:hover {
      border-color: #fff;
      color: #fff;
    }

    /* SCORE */
    #scoreboard {
      position: fixed;
      top: 10px;
      left: 10px;
      font-size: 1.2em;
      text-shadow: 0 0 5px #0ff;
    }
  </style>
</head>
<body>
  <!-- Overlay (Start & Game Over) -->
  <div class="overlay" id="overlay">
    <h1 id="title">NEON RUNNER</h1>
    <div class="actions">
      <button class="cta" id="startBtn">Mulai Game</button>
      <button class="ghost" id="backMenu">üè† Kembali ke Menu</button>
      <button class="ghost" id="muteBtn">üîà Suara: ON</button>
      <button class="ghost" id="resetHi">Reset High Score</button>
    </div>
  </div>

  <!-- Canvas -->
  <canvas id="gameCanvas" width="800" height="400"></canvas>
  <div id="scoreboard">Score: 0 | High: 0</div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const overlay = document.getElementById("overlay");
    const title = document.getElementById("title");
    const startBtn = document.getElementById("startBtn");
    const backMenuBtn = document.getElementById("backMenu");
    const muteBtn = document.getElementById("muteBtn");
    const resetHiBtn = document.getElementById("resetHi");
    const scoreboard = document.getElementById("scoreboard");

    // GAME VARIABLES
    let player, obstacles, score, highScore, gameSpeed, gravity, jumpPower;
    let isJumping = false;
    let isGameOver = false;
    let soundsOn = true;

    // LOAD HIGH SCORE
    highScore = parseInt(localStorage.getItem("neonHighScore")) || 0;

    // AUDIO (simple beep)
    const beep = new AudioContext();
    function playBeep(freq = 440, duration = 100) {
      if (!soundsOn) return;
      const osc = beep.createOscillator();
      const gain = beep.createGain();
      osc.connect(gain);
      gain.connect(beep.destination);
      osc.frequency.value = freq;
      osc.type = "sawtooth";
      osc.start();
      gain.gain.setValueAtTime(0.1, beep.currentTime);
      osc.stop(beep.currentTime + duration/1000);
    }

    function resetGame() {
      player = {
        x: 50,
        y: canvas.height - 60,
        size: 40,
        dy: 0,
        color: "#0ff"
      };
      obstacles = [];
      score = 0;
      gameSpeed = 4;
      gravity = 0.5;
      jumpPower = -10;
      isJumping = false;
      isGameOver = false;
    }

    function spawnObstacle() {
      const size = 20 + Math.random() * 30;
      obstacles.push({
        x: canvas.width,
        y: canvas.height - size - 20,
        size,
        color: "#f0f"
      });
    }

    let frame = 0;
    function update() {
      if (isGameOver) return;

      ctx.clearRect(0,0,canvas.width,canvas.height);

      // Draw player
      ctx.fillStyle = player.color;
      ctx.shadowColor = player.color;
      ctx.shadowBlur = 20;
      ctx.fillRect(player.x, player.y, player.size, player.size);
      ctx.shadowBlur = 0;

      // Gravity
      player.y += player.dy;
      player.dy += gravity;
      if (player.y + player.size > canvas.height - 20) {
        player.y = canvas.height - player.size - 20;
        player.dy = 0;
        isJumping = false;
      }

      // Ground
      ctx.fillStyle = "#222";
      ctx.fillRect(0, canvas.height-20, canvas.width, 20);

      // Obstacles
      for (let i=0; i<obstacles.length; i++) {
        let o = obstacles[i];
        o.x -= gameSpeed;
        ctx.fillStyle = o.color;
        ctx.shadowColor = o.color;
        ctx.shadowBlur = 15;
        ctx.fillRect(o.x, o.y, o.size, o.size);
        ctx.shadowBlur = 0;

        // Collision
        if (player.x < o.x + o.size &&
            player.x + player.size > o.x &&
            player.y < o.y + o.size &&
            player.y + player.size > o.y) {
          endGame();
        }
      }

      // Remove passed obstacles
      obstacles = obstacles.filter(o => o.x + o.size > 0);

      // Score
      frame++;
      if (frame % 60 === 0) {
        spawnObstacle();
      }
      score++;
      gameSpeed += 0.002;

      // Update scoreboard
      scoreboard.textContent = `Score: ${score} | High: ${highScore}`;

      requestAnimationFrame(update);
    }

    function jump() {
      if (!isJumping) {
        player.dy = jumpPower;
        isJumping = true;
        playBeep(600,150);
      }
    }

    function endGame() {
      isGameOver = true;
      playBeep(200,400);
      if (score > highScore) {
        highScore = score;
        localStorage.setItem("neonHighScore", highScore);
      }
      title.textContent = "GAME OVER";
      startBtn.textContent = "Main Lagi";
      overlay.style.display = "flex";
    }

    // CONTROLS
    document.addEventListener("keydown", e => {
      if (e.code === "Space" || e.code === "ArrowUp") {
        jump();
      }
    });
    canvas.addEventListener("click", jump);

    startBtn.addEventListener("click", () => {
      resetGame();
      overlay.style.display = "none";
      update();
    });

    backMenuBtn.addEventListener("click", () => {
      window.location.href = "../index.html"; // balik ke menu utama
    });

    muteBtn.addEventListener("click", () => {
      soundsOn = !soundsOn;
      muteBtn.textContent = soundsOn ? "üîà Suara: ON" : "üîá Suara: OFF";
    });

    resetHiBtn.addEventListener("click", () => {
      localStorage.removeItem("neonHighScore");
      highScore = 0;
      scoreboard.textContent = `Score: ${score} | High: ${highScore}`;
    });

    // SHOW overlay pertama kali
    overlay.style.display = "flex";
    title.textContent = "NEON RUNNER";
    startBtn.textContent = "Mulai Game";
  </script>
</body>
</html>
